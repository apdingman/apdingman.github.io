<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Resource Level AWS IoT Logging | Adam Dingman</title><meta name=keywords content><meta name=description content="TL;DR: AWS recently announced the ability to configure log levels by client ID, source IP, or principal ID. See how to do it here.
Are you managing a fleet of devices on AWS IoT Core? If so, you likely know that the CloudWatch log group AWSIotLogsV2 can be your best friend for troubleshooting connectivity issues between devices and the IoT core broker. Scraping through logs in this log group can highlight some key information about the successes/failures of your device’s connectivity like seen in Figure 1."><meta name=author content><link rel=canonical href=https://apdingman.github.io/posts/aws/resource-level-iot-logging/><link crossorigin=anonymous href=/assets/css/stylesheet.bc1149f4a72aa4858d3a9f71462f75e5884ffe8073ea9d6d5761d5663d651e20.css integrity="sha256-vBFJ9KcqpIWNOp9xRi915YhP/oBz6p1tV2HVZj1lHiA=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://apdingman.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://apdingman.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://apdingman.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://apdingman.github.io/apple-touch-icon.png><link rel=mask-icon href=https://apdingman.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="Resource Level AWS IoT Logging"><meta property="og:description" content="TL;DR: AWS recently announced the ability to configure log levels by client ID, source IP, or principal ID. See how to do it here.
Are you managing a fleet of devices on AWS IoT Core? If so, you likely know that the CloudWatch log group AWSIotLogsV2 can be your best friend for troubleshooting connectivity issues between devices and the IoT core broker. Scraping through logs in this log group can highlight some key information about the successes/failures of your device’s connectivity like seen in Figure 1."><meta property="og:type" content="article"><meta property="og:url" content="https://apdingman.github.io/posts/aws/resource-level-iot-logging/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-11-18T22:06:15-05:00"><meta property="article:modified_time" content="2022-11-18T22:06:15-05:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Resource Level AWS IoT Logging"><meta name=twitter:description content="TL;DR: AWS recently announced the ability to configure log levels by client ID, source IP, or principal ID. See how to do it here.
Are you managing a fleet of devices on AWS IoT Core? If so, you likely know that the CloudWatch log group AWSIotLogsV2 can be your best friend for troubleshooting connectivity issues between devices and the IoT core broker. Scraping through logs in this log group can highlight some key information about the successes/failures of your device’s connectivity like seen in Figure 1."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"https://apdingman.github.io/posts/"},{"@type":"ListItem","position":3,"name":"Resource Level AWS IoT Logging","item":"https://apdingman.github.io/posts/aws/resource-level-iot-logging/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Resource Level AWS IoT Logging","name":"Resource Level AWS IoT Logging","description":"TL;DR: AWS recently announced the ability to configure log levels by client ID, source IP, or principal ID. See how to do it here.\nAre you managing a fleet of devices on AWS IoT Core? If so, you likely know that the CloudWatch log group AWSIotLogsV2 can be your best friend for troubleshooting connectivity issues between devices and the IoT core broker. Scraping through logs in this log group can highlight some key information about the successes/failures of your device’s connectivity like seen in Figure 1.","keywords":[],"articleBody":"TL;DR: AWS recently announced the ability to configure log levels by client ID, source IP, or principal ID. See how to do it here.\nAre you managing a fleet of devices on AWS IoT Core? If so, you likely know that the CloudWatch log group AWSIotLogsV2 can be your best friend for troubleshooting connectivity issues between devices and the IoT core broker. Scraping through logs in this log group can highlight some key information about the successes/failures of your device’s connectivity like seen in Figure 1.\nAccount-Level Logging Most of the time, you’re only looking for messages with a log level of Error, but sometimes, you might want to see things from a little more granular view. You can subsequently flip the log level setting in IoT Core on the account level to Warning, Info, or if you’re really feeling froggy, Debug.\nEasy right? Right. BUT….if you have more than a couple dozen devices connecting to the broker, pumping Debug level logs into CloudWatch can get expensive FAST! I may just have a few scars from an account that had 500k+ devices in the fleet. Thankfully, there are options to help with this. However, they’re buried a little deeper than you might expect.\nResource Level Logging by Thing Group The option that has been around a while is to throw the things you want to increase the log level on into a thing group and set a unique log level for that thing group using the AWS CLI command set-v2-logging-level.\naws iot set-v2-logging-level \\ --log-target targetType=THING_GROUP,targetName=THINGGROUP1 \\ --log-level DEBUG Resource Level Logging by Client ID, Source IP, or Principal ID What about if you just want to set the log level to debug on just a couple things without dinking around with creating and managing a thing group? Well, in February 2022, the AWS IoT core product team delivered by announcing support for setting fine-grained logging levels using client ID, source IP, or principal ID.\nIt’s quite simple to take advantage of this new capability as they baked it right into the same aws cli command set-v2-logging-level. You simply just pass a targetType of CLIENT_ID, SOURCE_IP, or PRINCIPAL_ID instead of THING_GROUP.\naws iot set-v2-logging-level \\ --log-target targetType=CLIENT_ID,targetName=THING1 \\ --log-level DEBUG See here for the AWS official documentation on resource-specific logging in AWS IoT: https://docs.aws.amazon.com/iot/latest/developerguide/configure-logging.html#fine-logging-cli\n","wordCount":"384","inLanguage":"en","datePublished":"2022-11-18T22:06:15-05:00","dateModified":"2022-11-18T22:06:15-05:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://apdingman.github.io/posts/aws/resource-level-iot-logging/"},"publisher":{"@type":"Organization","name":"Adam Dingman","logo":{"@type":"ImageObject","url":"https://apdingman.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://apdingman.github.io accesskey=h title="Adam Dingman (Alt + H)">Adam Dingman</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://apdingman.github.io/about-me title="About Me"><span>About Me</span></a></li><li><a href=https://apdingman.github.io/posts title=Blog><span>Blog</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>Resource Level AWS IoT Logging</h1><div class=post-meta><span title='2022-11-18 22:06:15 -0500 -0500'>November 18, 2022</span></div></header><div class=post-content><p><strong>TL;DR:</strong> AWS recently announced the ability to configure log levels by client ID, source IP, or principal ID. See how to do it here.</p><p>Are you managing a fleet of devices on AWS IoT Core? If so, you likely know that the CloudWatch log group AWSIotLogsV2 can be your best friend for troubleshooting connectivity issues between devices and the IoT core broker. Scraping through logs in this log group can highlight some key information about the successes/failures of your device’s connectivity like seen in Figure 1.</p><h2 id=account-level-logging>Account-Level Logging<a hidden class=anchor aria-hidden=true href=#account-level-logging>#</a></h2><p>Most of the time, you’re only looking for messages with a log level of Error, but sometimes, you might want to see things from a little more granular view. You can subsequently flip the log level setting in IoT Core on the account level to Warning, Info, or if you’re really feeling froggy, Debug.</p><p>Easy right? Right. BUT….if you have more than a couple dozen devices connecting to the broker, pumping Debug level logs into CloudWatch can get expensive FAST! I may just have a few scars from an account that had 500k+ devices in the fleet. Thankfully, there are options to help with this. However, they’re buried a little deeper than you might expect.</p><h2 id=resource-level-logging-by-thing-group>Resource Level Logging by Thing Group<a hidden class=anchor aria-hidden=true href=#resource-level-logging-by-thing-group>#</a></h2><p>The option that has been around a while is to throw the things you want to increase the log level on into a thing group and set a unique log level for that thing group using the AWS CLI command set-v2-logging-level.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell-session data-lang=shell-session><span style=display:flex><span>aws iot set-v2-logging-level \
</span></span><span style=display:flex><span>  --log-target targetType=THING_GROUP,targetName=THINGGROUP1 \
</span></span><span style=display:flex><span>  --log-level DEBUG
</span></span></code></pre></div><h2 id=resource-level-logging-by-client-id-source-ip-or-principal-id>Resource Level Logging by Client ID, Source IP, or Principal ID<a hidden class=anchor aria-hidden=true href=#resource-level-logging-by-client-id-source-ip-or-principal-id>#</a></h2><p>What about if you just want to set the log level to debug on just a couple things without dinking around with creating and managing a thing group? <strong>Well, in February 2022, the AWS IoT core product team delivered by announcing support for setting fine-grained logging levels using client ID, source IP, or principal ID.</strong></p><p>It’s quite simple to take advantage of this new capability as they baked it right into the same aws cli command set-v2-logging-level. You simply just pass a targetType of CLIENT_ID, SOURCE_IP, or PRINCIPAL_ID instead of THING_GROUP.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell-session data-lang=shell-session><span style=display:flex><span>aws iot set-v2-logging-level \ 
</span></span><span style=display:flex><span>  --log-target targetType=CLIENT_ID,targetName=THING1 \
</span></span><span style=display:flex><span>  --log-level DEBUG
</span></span></code></pre></div><p>See here for the AWS official documentation on resource-specific logging in AWS IoT: <a href=https://docs.aws.amazon.com/iot/latest/developerguide/configure-logging.html#fine-logging-cli>https://docs.aws.amazon.com/iot/latest/developerguide/configure-logging.html#fine-logging-cli</a></p></div><footer class=post-footer><ul class=post-tags></ul></footer></article></main><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>